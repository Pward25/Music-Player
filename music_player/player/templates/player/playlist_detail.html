{% extends 'player/base.html' %}
{% load static %}
{% block title %}{{ playlist.title }}{% endblock %}
{% block content %}
<h2>{{ playlist.title }}</h2>
{% if playlist.description %}<p>{{ playlist.description }}</p>{% endif %}

<div id="player-app" data-playlist-id="{{ playlist.id }}">
  <div class="player-panel">
    <div id="current-track-info">
      <div id="track-title">Select a song to play</div>
      <div id="track-artist"></div>
    </div>

    <audio id="audio" preload="metadata"></audio>

    <div class="controls">
      <button id="prev-btn" title="Previous">⮜</button>
      <button id="play-btn" title="Play/Pause">▶️</button>
      <button id="next-btn" title="Next">⮞</button>
      <input id="volume" type="range" min="0" max="1" step="0.01" value="1">
    </div>

    <div class="progress-wrap">
      <span id="current-time">0:00</span>
      <input id="seek" type="range" min="0" max="100" value="0">
      <span id="duration">0:00</span>
    </div>
  </div>
  
  <a href="{% url 'player:delete_playlist' playlist.id %}" class="btn btn-danger">Delete Playlist</a>

  <ul id="song-list" class="song-list">
    {% for song in songs %}
    <li class="song" data-src="{{ song.audio_file.url }}" data-title="{{ song.title|escapejs }}" data-artist="{{ song.artist|escapejs }}">
      <span class="song-title">{{ song.title }}</span>
      <small class="song-artist">{{ song.artist }}</small>
      <button class="play-song">Play</button>
    </li>
    {% endfor %}
  </ul>
</div>

{% endblock %}

{% block scripts %}
<script>
  // Provide initial playlist data to player.js
  window.PLAYER_DATA = {
    songs: Array.from(document.querySelectorAll('#song-list .song')).map(li => ({
      src: li.dataset.src,
      title: li.dataset.title,
      artist: li.dataset.artist
    }))
  };
</script>
<script src="{% static 'player/js/player.js' %}"></script>
{% endblock %}